---
title: "Assignment V: GitHub and the ticketmaster.com API"
subtitle: "Data Science Project Management | Winter Term 2020/21"
author: "Submitted by Franziska MÃ¼ller (Student ID: 5401673)"
date: "February, 16, 2021"
output: 
  html_document:
  toc: true
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
I hereby assure that my submission is in line with the *Code of Conduct* outlined on the lecture slides. I worked on my own.

## General setup

Before I start the project, I clear my workspace. 
# Note regarding key and maybe working directory

```{r preparation, message = FALSE, warning = FALSE}
# Clear workspace
rm(list = ls())

# Maybe note regarding individual working directory 

# Source private key - insert yout indicidual path to the key
source("C:/Users/Francesca/Desktop/MA_WiSe 202021/Data Science Project Management/Assignments/key_ticketmaster.R")
```

## Exercise 2: Getting to know the API

Rate limit is given by 5 requests per second and max. 5,000 requests per day.


## Exercise 3: Interacting with the API - the basics

*Load the packages needed to interact with APIs using R.*
```{r packages, message = FALSE, warning = FALSE}
# Check if packages have been installed before; if not, install them
if (!require("jsonlite")) install.packages("jsonlite")
if (!require("httr")) install.packages("httr")
if (!require("rlist")) install.packages("rlist")
if (!require("tidyverse")) install.packages("tidyverse")
# if (!require("naniar")) install.packages("naniar")

# Load packages
library(jsonlite)  
library(httr)
library(rlist)
library(tidyverse)
# library(naniar)
```

*Perform a first GET request, that searches for event venues in Germany (countryCode = "DE"). Extract the content from the response object and inspect the resulting list. Describe what you can see.*

```{r first_GET_request}
# Event venues in Germany
country <- "DE"
Ex2_url <- paste0("https://app.ticketmaster.com/discovery/v2/venues.json?apikey=", key)
Ex3_resp_obj <- GET(url = Ex2_url, 
                    query = list(countryCode = country))
Ex3_cont_obj <- Ex3_resp_obj %>% content()
```
The resulting content object is a list with nested structure. It contains the lists named ``r names(Ex3_cont_obj)[1]``, ``r names(Ex3_cont_obj)[2]`` and `` names(Ex3_cont_obj)[3]``. The first one covers different venues and detailed information about a specific venue such as name, type, postal code etc. Interesting here, the lists have different lenghts. Therefore, not every information is given for every venue.
The second one contains links regarding the first, self (actual scraped page), next and last page. Here, it is shown that there are 3465 pages in total with 20 results each. In the last one also information about pages and results is given but just the raw information without the respective url. Again, there are ``r Ex3_cont_obj[["page"]][["totalPages"]]`` pages with ``r Ex3_cont_obj[["page"]][["size"]]`` elements each (in total: ``r Ex3_cont_obj[["page"]][["totalElements"]]`` elements).

*Extract 'name', 'city', 'postalCode', 'adress', 'url', longitude', 'latitude'.*
nam # Ex3_cont_obj[["_embedded"]][["venues"]][[1]][["name"]]
city # Ex3_cont_obj[["_embedded"]][["venues"]][[1]][["city"]][["name"]]
postal code # Ex3_cont_obj[["_embedded"]][["venues"]][[1]][["postalCode"]]
adress # Ex3_cont_obj[["_embedded"]][["venues"]][[1]][["address"]][["line1"]]
url # Ex3_cont_obj[["_embedded"]][["venues"]][[1]][["url"]]
longitude # Ex3_cont_obj[["_embedded"]][["venues"]][[1]][["location"]][["longitude"]]
latitude # Ex3_cont_obj[["_embedded"]][["venues"]][[1]][["location"]][["latitude"]]

# Will get 20 different venues (size = 20, but note the high amount of pages)

```{r Extracting_specific_elements}
# Create an empty data frame with number of rows = 20
n = 20
df_Ex3 <- tibble(name = character(n),
                 city = character(n),
                 postalCode = character(n),
                 adress = character(n),
                 url = character(n),
                 longitude = character(n),  # is.double anpassen 
                 latitude = character(n))

for (i in 1:n) {
  # Name variable
  df_Ex3[i, 1] <- as.tibble(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["name"]])  # ith row, first col 
  # City variable
  df_Ex3[i, 2] <- as.tibble(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["city"]][["name"]])
  # postalCode variable
  df_Ex3[i, 3] <- as.tibble(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["postalCode"]])
  # adress variable
  df_Ex3[i, 4] <- as.tibble(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["address"]][["line1"]])
  # url variable 
  df_Ex3[i, 5] <- as.tibble(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["url"]])
  }

# Now considering longitude variable 
for (i in 1:n) {
  if (is.character(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["location"]][["longitude"]]) == FALSE) {
    df_Ex3[i, 6] <- NA
  }
  else {
    df_Ex3[i, 6] <- as.tibble(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["location"]][["longitude"]])
  }
}
# Considering latitude variable
for (i in 1:n) {
  if (is.character(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["location"]][["latitude"]]) == FALSE) {
    df_Ex3[i, 7] <- NA
  }
  else {
    df_Ex3[i, 7] <- as.tibble(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["location"]][["latitude"]])
  }
}


# maybe somtehing class(xyz) != character
# ifelse(x <= 0.001 | x > 0.1, NA, x)

# Longitude variable
  df_Ex3[i, 6] <- as.tibble(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["location"]][["longitude"]])
  
  # Latitude variable
  df_Ex3[i, 7] <- as.tibble(Ex3_cont_obj[["_embedded"]][["venues"]][[i]][["location"]][["latitude"]])
```


